{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/lib/supabase.ts","../../server/routes/properties.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.SUPABASE_URL\r\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n// Check if Supabase is properly configured\r\nconst isSupabaseConfigured = supabaseUrl && supabaseServiceKey &&\r\n  supabaseUrl !== 'your_supabase_project_url' &&\r\n  supabaseServiceKey !== 'your_supabase_service_role_key'\r\n\r\nif (!isSupabaseConfigured) {\r\n  console.warn('âš ï¸  Supabase not configured. Please set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY in your .env file.')\r\n}\r\n\r\n// Create a mock client if not configured, or the real client if configured\r\nexport const supabase = isSupabaseConfigured\r\n  ? createClient(supabaseUrl, supabaseServiceKey, {\r\n      auth: {\r\n        autoRefreshToken: false,\r\n        persistSession: false\r\n      }\r\n    })\r\n  : null as any // Mock client for development\r\n\r\n// Database types\r\nexport interface Property {\r\n  id?: number\r\n  title: string\r\n  price: string\r\n  image: string\r\n  beds: number\r\n  baths: number\r\n  size: string\r\n  area: string\r\n  city: 'dubai' | 'abu-dhabi' | 'al-ain'\r\n  created_at?: string\r\n  updated_at?: string\r\n}","import express from 'express';\r\nimport { supabase, Property } from '../lib/supabase.js';\r\n\r\nconst router = express.Router();\r\n\r\n// GET /api/properties/:area - Get properties for a specific area\r\nrouter.get('/properties/:area', async (req, res) => {\r\n  try {\r\n    // Check if Supabase is configured\r\n    if (!supabase) {\r\n      return res.status(503).json({\r\n        error: 'Database not configured',\r\n        message: 'Please configure Supabase environment variables'\r\n      });\r\n    }\r\n\r\n    const { area } = req.params;\r\n\r\n    // Convert area name to city enum\r\n    const cityMap: { [key: string]: Property['city'] } = {\r\n      'dubai': 'dubai',\r\n      'abu-dhabi': 'abu-dhabi',\r\n      'al-ain': 'al-ain'\r\n    };\r\n\r\n    const city = cityMap[area];\r\n    if (!city) {\r\n      return res.status(400).json({ error: 'Invalid area' });\r\n    }\r\n\r\n    const { data: properties, error } = await supabase\r\n      .from('properties')\r\n      .select('*')\r\n      .eq('city', city)\r\n      .order('created_at', { ascending: false });\r\n\r\n    if (error) {\r\n      throw error;\r\n    }\r\n\r\n    res.json(properties || []);\r\n  } catch (error) {\r\n    console.error('Error fetching properties:', error);\r\n    res.status(500).json({ error: 'Failed to fetch properties' });\r\n  }\r\n});\r\n\r\n// POST /api/properties/:area - Add new property to an area\r\nrouter.post('/properties/:area', async (req, res) => {\r\n  try {\r\n    // Check if Supabase is configured\r\n    if (!supabase) {\r\n      return res.status(503).json({\r\n        error: 'Database not configured',\r\n        message: 'Please configure Supabase environment variables'\r\n      });\r\n    }\r\n\r\n    const { area } = req.params;\r\n    const propertyData = req.body;\r\n\r\n    // Convert area name to city enum\r\n    const cityMap: { [key: string]: Property['city'] } = {\r\n      'dubai': 'dubai',\r\n      'abu-dhabi': 'abu-dhabi',\r\n      'al-ain': 'al-ain'\r\n    };\r\n\r\n    const city = cityMap[area];\r\n    if (!city) {\r\n      return res.status(400).json({ error: 'Invalid area' });\r\n    }\r\n\r\n    // Prepare property data\r\n    const newProperty: Omit<Property, 'id' | 'created_at' | 'updated_at'> = {\r\n      title: propertyData.title,\r\n      price: propertyData.price,\r\n      image: propertyData.image,\r\n      beds: propertyData.beds,\r\n      baths: propertyData.baths,\r\n      size: propertyData.size,\r\n      area: propertyData.area,\r\n      city: city\r\n    };\r\n\r\n    const { data, error } = await supabase\r\n      .from('properties')\r\n      .insert([newProperty])\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      throw error;\r\n    }\r\n\r\n    res.json({ success: true, property: data });\r\n  } catch (error) {\r\n    console.error('Error adding property:', error);\r\n    res.status(500).json({ error: 'Failed to add property' });\r\n  }\r\n});\r\n\r\n// POST /api/webhook/properties - Webhook endpoint for third-party updates\r\nrouter.post('/webhook/properties', async (req, res) => {\r\n  try {\r\n    // Check if Supabase is configured\r\n    if (!supabase) {\r\n      return res.status(503).json({\r\n        error: 'Database not configured',\r\n        message: 'Please configure Supabase environment variables'\r\n      });\r\n    }\r\n\r\n    const { area, properties: newProperties } = req.body;\r\n\r\n    // Convert area name to city enum\r\n    const cityMap: { [key: string]: Property['city'] } = {\r\n      'dubai': 'dubai',\r\n      'abu-dhabi': 'abu-dhabi',\r\n      'al-ain': 'al-ain'\r\n    };\r\n\r\n    const city = cityMap[area];\r\n    if (!city) {\r\n      return res.status(400).json({ error: 'Invalid area' });\r\n    }\r\n\r\n    // Prepare properties for insertion\r\n    const propertiesToInsert = newProperties.map((prop: any) => ({\r\n      title: prop.title,\r\n      price: prop.price,\r\n      image: prop.image,\r\n      beds: prop.beds,\r\n      baths: prop.baths,\r\n      size: prop.size,\r\n      area: prop.area,\r\n      city: city\r\n    }));\r\n\r\n    const { data, error } = await supabase\r\n      .from('properties')\r\n      .insert(propertiesToInsert)\r\n      .select();\r\n\r\n    if (error) {\r\n      throw error;\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      message: `Added ${data?.length || 0} properties to ${area}`,\r\n      properties: data\r\n    });\r\n  } catch (error) {\r\n    console.error('Error updating properties via webhook:', error);\r\n    res.status(500).json({ error: 'Failed to update properties' });\r\n  }\r\n});\r\n\r\nexport default router;","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\nimport propertiesRouter from \"./routes/properties\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Example API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n\n  // Properties API routes\n  app.use('/api', propertiesRouter);\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["express","app","propertiesRouter"],"mappings":"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"}